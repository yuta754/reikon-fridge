<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<title>ğŸ  ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»é¢</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
	<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.css" rel="stylesheet">
	<style>
		:root {
			--gradient-top: #cce7ff;
			--gradient-middle: #f9fcff;
			--gradient-bottom: #ffffff;
		}

		* {
			box-sizing: border-box;
		}

		body {
			font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
			min-height: 100vh;
			min-height: -webkit-fill-available;
			margin: 0;
			padding: 15px;
			text-align: center;
			background: linear-gradient(to bottom, var(--gradient-top) 0%, var(--gradient-middle) 50%, var(--gradient-bottom) 100%);
		}

		.room {
			width: 100%;
			max-width: 1100px;
			margin: 0 auto;
			background-color: #FFFFFF;
			padding: 20px 15px;
			border: 1px solid #C8C8C8;
			border-radius: 12px;
			box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
		}

		.header-controls {
			display: flex;
			justify-content: flex-end;
			align-items: flex-start;
			margin-bottom: 15px;
		}

		.logout-button {
			background-color: #E0E0E0;
			color: #4A4A4A;
			border: none;
			padding: 10px 16px;
			cursor: pointer;
			border-radius: 8px;
			transition: background-color 0.2s;
			font-size: 0.9em;
			-webkit-tap-highlight-color: transparent;
		}

		.logout-button:active {
			background-color: #CCCCCC;
		}

		@media (hover: hover) {
			.logout-button:hover {
				background-color: #CCCCCC;
			}
		}

		h1 {
			font-family: 'Cinzel', serif;
			font-size: clamp(24px, 6vw, 42px);
			color: #1a1a1a;
			letter-spacing: 2px;
			text-transform: uppercase;
			border-bottom: 2px solid #c5a572;
			display: inline-block;
			padding-bottom: 6px;
			margin: 10px 0 30px 0;
		}

		.main-content {
			width: 100%;
			display: grid;
			grid-template-columns: 1fr;
			gap: 20px;
			margin-bottom: 30px;
		}

		.refrigerator-section {
			width: 100%;
		}
			cursor: pointer;
			background: linear-gradient(145deg, #F5F5F5, #E0E0E0);
			border: 1px solid #C8C8C8;
			padding: 0;
			width: 100%;
			min-height: 280px;
			height: auto;
			border-radius: 15px;
			box-shadow: 4px 4px 15px rgba(0, 0, 0, 0.15);
			transition: transform 0.2s, box-shadow 0.2s;
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			-webkit-tap-highlight-color: transparent;
		}

		.refrigerator-button:active {
			transform: scale(0.98);
		}

		@media (hover: hover) {
			.refrigerator-button:hover {
				transform: translateY(-5px);
				box-shadow: 6px 6px 20px rgba(0, 0, 0, 0.2);
			}
		}

		.refrigerator-icon {
			font-size: clamp(100px, 20vw, 150px);
			color: #28A745;
			margin-bottom: 20px;
		}

		.refrigerator-label {
			font-weight: bold;
			font-size: clamp(1.2em, 4vw, 1.5em);
			color: #333;
		}

		.controller-panel {
			background-color: #343A40;
			color: #fff;
			padding: 20px;
			border-radius: 12px;
			width: 100%;
		}

		.controller-panel h2 {
			font-size: 1.1em;
			margin-bottom: 15px;
			border-bottom: 1px solid #495057;
			padding-bottom: 8px;
			text-align: center;
		}

		.panel-grid {
			display: grid;
			grid-template-columns: repeat(2, 1fr);
			gap: 10px;
			width: 100%;
		}

		.panel-item {
			width: 100%;
			min-height: 100px;
			border: none;
			padding: 15px 10px;
			cursor: pointer;
			border-radius: 10px;
			transition: all 0.2s;
			font-size: 1em;
			-webkit-tap-highlight-color: transparent;
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
		}

		.panel-item:active {
			transform: scale(0.95);
		}

		.panel-item .label {
			display: block;
			font-size: 0.85em;
			margin-top: 5px;
			font-weight: bold;
		}

		.panel-icon {
			font-size: 32px;
			margin-bottom: 8px;
		}

		.waste-rate-button {
			background-color: #FFC107;
			color: #333;
		}

		.waste-rate-button:active {
			background-color: #E0A800;
		}

		.shopping-list-button {
			background-color: #17A2B8;
			color: #fff;
		}

		.shopping-list-button:active {
			background-color: #138496;
		}

		.user-manage-button {
			background-color: #6C757D;
			color: #fff;
		}

		.user-manage-button:active {
			background-color: #5A6268;
		}

		.ai-chat-button {
			background-color: #9C27B0;
			color: #fff;
		}

		.ai-chat-button:active {
			background-color: #7B1FA2;
		}

		.event-section {
			margin-top: 30px;
			background: linear-gradient(135deg, #ffe4a1, #ffb347);
			padding: 20px;
			border-radius: 12px;
			color: #4a3b00;
			box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
			cursor: pointer;
			-webkit-tap-highlight-color: transparent;
		}

		.event-section h3 {
			font-size: clamp(1.1em, 4vw, 1.3em);
			margin: 0 0 10px 0;
		}

		.event-section p {
			margin: 0;
			font-size: clamp(0.9em, 3vw, 1em);
		}

		.calendar-section {
			margin-top: 30px;
			background: #fff;
			padding: 15px;
			border-radius: 12px;
			box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
		}

		.calendar-section h3 {
			margin-bottom: 15px;
			color: #333;
			font-size: clamp(1em, 4vw, 1.2em);
		}

		#calendar {
			max-width: 100%;
			margin: 0 auto;
		}

		.news-section {
			margin-top: 30px;
			text-align: left;
		}

		.news-title {
			font-size: clamp(1em, 4vw, 1.2em);
			font-weight: bold;
			color: #333;
			margin-bottom: 15px;
		}

		.news-card {
			background: #fff;
			border-left: 5px solid #007BFF;
			padding: 12px 15px;
			border-radius: 8px;
			box-shadow: 1px 2px 6px rgba(0, 0, 0, 0.1);
			margin-bottom: 10px;
			font-size: clamp(0.85em, 3vw, 0.95em);
		}

		.news-card strong {
			color: #007BFF;
		}

		.modal {
			display: none;
			position: fixed;
			z-index: 1000;
			padding: 20px;
			left: 0;
			top: 0;
			width: 100%;
			height: 100%;
			background-color: rgba(0, 0, 0, 0.5);
			overflow-y: auto;
		}

		.modal-content {
			background-color: #fff9f0;
			margin: auto;
			padding: 25px 20px;
			border: 2px solid #ffb347;
			width: 100%;
			max-width: 400px;
			border-radius: 12px;
			text-align: center;
			box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
			animation: fadeIn 0.3s ease-in-out;
			position: relative;
			top: 50%;
			transform: translateY(-50%);
		}

		.chat-modal-content {
			background-color: #ffffff;
			margin: 0;
			padding: 0;
			border: none;
			width: 100%;
			max-width: 600px;
			height: 90vh;
			max-height: 90vh;
			border-radius: 15px;
			box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
			display: flex;
			flex-direction: column;
			animation: fadeIn 0.3s ease-in-out;
			position: fixed;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
		}

		.chat-header {
			background: linear-gradient(135deg, #9C27B0, #7B1FA2);
			color: white;
			padding: 18px 15px;
			border-radius: 15px 15px 0 0;
			display: flex;
			justify-content: space-between;
			align-items: center;
			flex-shrink: 0;
		}

		.chat-header h2 {
			margin: 0;
			font-size: clamp(1.1em, 4vw, 1.5em);
		}

		.close-btn {
			color: white;
			font-size: 28px;
			font-weight: bold;
			cursor: pointer;
			background: none;
			border: none;
			padding: 0;
			-webkit-tap-highlight-color: transparent;
		}

		.close-btn:active {
			color: #ffccff;
		}

		.chat-messages {
			flex: 1;
			overflow-y: auto;
			padding: 15px;
			background-color: #f5f5f5;
			-webkit-overflow-scrolling: touch;
		}

		.message {
			margin-bottom: 15px;
			display: flex;
			width: 100%;
		}

		.message.ai {
			justify-content: flex-start;
		}

		.message.user {
			justify-content: flex-end;
		}

		.message-bubble {
			max-width: 85%;
			padding: 12px 16px;
			border-radius: 18px;
			word-wrap: break-word;
			white-space: pre-wrap;
			font-size: 14px;
			line-height: 1.5;
		}

		.message.ai .message-bubble {
			background-color: #f0f0f0;
			color: #333;
			border: 1px solid #ddd;
			border-bottom-left-radius: 4px;
			text-align: left;
		}

		.message.user .message-bubble {
			background-color: #9C27B0;
			color: white;
			border-bottom-right-radius: 4px;
			text-align: left;
		}

		.chat-input-container {
			padding: 12px;
			background-color: white;
			border-top: 1px solid #ddd;
			border-radius: 0 0 15px 15px;
			display: flex;
			gap: 8px;
			flex-shrink: 0;
		}

		.chat-input {
			flex: 1;
			padding: 12px;
			border: 1px solid #ddd;
			border-radius: 25px;
			font-size: 16px;
			outline: none;
			-webkit-appearance: none;
		}

		.chat-input:focus {
			border-color: #9C27B0;
		}

		.send-btn {
			background-color: #9C27B0;
			color: white;
			border: none;
			padding: 12px 20px;
			border-radius: 25px;
			cursor: pointer;
			font-weight: bold;
			transition: background-color 0.2s;
			-webkit-tap-highlight-color: transparent;
			font-size: 14px;
		}

		.send-btn:active {
			background-color: #7B1FA2;
		}

		.send-btn:disabled {
			background-color: #ccc;
			cursor: not-allowed;
		}

		.typing-indicator {
			display: none;
			padding: 10px 15px;
			color: #666;
			font-style: italic;
			font-size: 14px;
			background-color: #f5f5f5;
		}

		@keyframes fadeIn {
			from {
				opacity: 0;
				transform: translateY(-20px);
			}
			to {
				opacity: 1;
				transform: translateY(0);
			}
		}

		/* ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆãƒ»PCï¼ˆ2ã‚«ãƒ©ãƒ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼‰ */
		@media screen and (min-width: 768px) {
			.room {
				padding: 30px;
			}

			.main-content {
				grid-template-columns: 1.8fr 1fr;
			}

			.refrigerator-button {
				min-height: 380px;
				padding: 40px 20px;
			}

			.refrigerator-icon {
				font-size: 160px;
			}

			.modal-content {
				padding: 30px 25px;
			}

			.chat-modal-content {
				height: 80vh;
			}

			.message-bubble {
				max-width: 70%;
			}

			.panel-item {
				min-height: 120px;
			}
		}

		/* ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ç¸¦å‘ã */
		@media screen and (max-width: 767px) {
			body {
				padding: 10px;
			}

			.room {
				padding: 15px 12px;
			}

			h1 {
				letter-spacing: 1px;
				margin-bottom: 20px;
			}

			.refrigerator-button {
				min-height: 300px;
			}

			.refrigerator-icon {
				font-size: 120px;
			}

			.panel-item {
				min-height: 90px;
				padding: 12px 8px;
			}

			.panel-icon {
				font-size: 28px;
			}
		}

		/* å°å‹ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ */
		@media screen and (max-width: 375px) {
			body {
				padding: 8px;
			}

			.room {
				padding: 12px 10px;
			}

			.refrigerator-button {
				min-height: 280px;
				padding: 30px 15px;
			}

			.refrigerator-icon {
				font-size: 100px;
			}

			.event-section,
			.calendar-section,
			.news-section {
				margin-top: 20px;
			}

			.controller-panel {
				padding: 15px 12px;
			}

			.panel-item {
				min-height: 85px;
				padding: 10px 8px;
			}

			.panel-icon {
				font-size: 24px;
			}
		}

		/* æ¨ªå‘ãå¯¾å¿œ */
		@media screen and (max-height: 500px) and (orientation: landscape) {
			.refrigerator-button {
				min-height: 180px;
			}

			.chat-modal-content {
				height: 95vh;
			}

			h1 {
				font-size: 24px;
				margin-bottom: 15px;
			}

			.event-section,
			.calendar-section {
				margin-top: 20px;
				padding: 15px;
			}
		}

		/* FullCalendarã®ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–èª¿æ•´ */
		.fc {
			font-size: 0.85em;
		}

		.fc .fc-toolbar-title {
			font-size: 1.2em;
		}

		.fc .fc-daygrid-day-number {
			font-size: 0.9em;
			padding: 2px;
		}

		.fc .fc-col-header-cell-cushion {
			padding: 4px 2px;
		}

		.fc .fc-daygrid-day-top {
			flex-direction: row;
			justify-content: center;
		}

		@media screen and (max-width: 767px) {
			.fc {
				font-size: 0.75em;
			}

			.fc .fc-toolbar {
				flex-direction: column;
				gap: 8px;
				margin-bottom: 12px !important;
			}

			.fc .fc-toolbar-chunk {
				display: flex;
				justify-content: center;
			}

			.fc .fc-toolbar-title {
				font-size: 1em;
			}

			.fc .fc-button {
				padding: 4px 8px;
				font-size: 0.9em;
			}

			.fc .fc-daygrid-day-number {
				font-size: 0.85em;
				padding: 1px;
			}

			.fc .fc-col-header-cell-cushion {
				padding: 2px 1px;
				font-size: 0.8em;
			}

			.fc .fc-daygrid-day-frame {
				min-height: 35px;
			}

			.fc .fc-daygrid-event {
				font-size: 0.75em;
				white-space: nowrap;
				overflow: hidden;
				text-overflow: ellipsis;
			}
		}

		@media screen and (max-width: 375px) {
			.fc {
				font-size: 0.7em;
			}

			.fc .fc-daygrid-day-frame {
				min-height: 30px;
			}

			.fc .fc-daygrid-day-number {
				font-size: 0.8em;
			}
		}
	</style>
</head>

<body>
	<div class="room">
		<div class="header-controls">
			<form method="post" action="/logout">
				<button type="submit" class="logout-button" title="ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ">
					<i class="fa-solid fa-right-from-bracket"></i> ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
				</button>
			</form>
		</div>

		<h1>Rei Concierge</h1>

		<div class="main-content">
			<div class="refrigerator-section">
				<form method="get" action="/selectFood">
					<button type="submit" class="refrigerator-button" title="é£Ÿæã®é¸æŠãƒ»ç™»éŒ²">
						<div class="visual">
							<i class="fa-solid fa-house refrigerator-icon"></i>
						</div>
						<span class="refrigerator-label">å†·è”µåº«</span>
					</button>
				</form>
			</div>

			<div class="controller-panel">
				<h2>Management Panel</h2>
				<div class="panel-grid">
					<form method="get" action="/waste-rate">
						<button type="submit" class="panel-item waste-rate-button" title="é£Ÿå“ãƒ­ã‚¹ç‡ã®ç¢ºèª">
							<i class="fa-solid fa-chart-pie panel-icon"></i>
							<span class="label">ãƒ­ã‚¹ç‡</span>
						</button>
					</form>
					<form method="post" action="/shoppingList">
						<button type="submit" class="panel-item shopping-list-button" title="è²·ã„ç‰©ãƒªã‚¹ãƒˆã®ç®¡ç†">
							<i class="fa-solid fa-bag-shopping panel-icon"></i>
							<span class="label">ãƒªã‚¹ãƒˆ</span>
						</button>
					</form>
					<button type="button" class="panel-item ai-chat-button" id="openAiChat" title="AIãƒ¬ã‚·ãƒ”æ¤œç´¢">
						<i class="fa-solid fa-robot panel-icon"></i>
						<span class="label">ãƒ¬ã‚·ãƒ”AI</span>
					</button>
					<form method="post" action="/menuManageUser">
						<button type="submit" class="panel-item user-manage-button" title="ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šãƒ»ç®¡ç†">
							<i class="fa-solid fa-user-gear panel-icon"></i>
							<span class="label">è¨­å®š</span>
						</button>
					</form>
				</div>
			</div>
		</div>

		<div class="event-section" id="halloweenEvent">
			<h3>ğŸƒ ãƒãƒ­ã‚¦ã‚£ãƒ³é™å®šãƒ¬ã‚·ãƒ”å…¬é–‹ä¸­!</h3>
			<p>ã‹ã¼ã¡ã‚ƒã‚’ä½¿ã£ãŸã‚¹ã‚¤ãƒ¼ãƒ„ã‚„ã‚¹ãƒ¼ãƒ—ã‚’æ¥½ã—ã‚‚ã†!</p>
		</div>

		<div class="calendar-section">
			<h3>ğŸ“… è³å‘³æœŸé™ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</h3>
			<div id="calendar"></div>
		</div>

		<div class="news-section">
			<div class="news-title">ãŠçŸ¥ã‚‰ã›</div>
			<div class="news-card"><strong>2025/10/22</strong>ã€€ãƒ¬ã‚·ãƒ”ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆAIãŒä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸï¼</div>
			<div class="news-card"><strong>2025/10/22</strong>ã€€ğŸƒãƒãƒ­ã‚¦ã‚£ãƒ³é™å®šãƒ¬ã‚·ãƒ”ã‚’å…¬é–‹ã—ã¾ã—ãŸ!</div>
			<div class="news-card"><strong>2025/10/21</strong>ã€€ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®ãŠçŸ¥ã‚‰ã›ï¼ˆ10/22 0:00ã€œ4:00ï¼‰</div>
			<div class="news-card"><strong>2025/10/20</strong>ã€€æ–°ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’ãƒªãƒªãƒ¼ã‚¹ã—ã¾ã—ãŸ!</div>
		</div>
	</div>

	<!-- ãƒãƒ­ã‚¦ã‚£ãƒ³ãƒ¬ã‚·ãƒ”ãƒ¢ãƒ¼ãƒ€ãƒ« -->
	<div id="recipeModal" class="modal">
		<div class="modal-content">
			<span class="close-btn" data-modal="recipeModal">&times;</span>
			<h2>ğŸƒ ãƒãƒ­ã‚¦ã‚£ãƒ³é™å®šãƒ¬ã‚·ãƒ”</h2>
			<p><strong>ã‹ã¼ã¡ã‚ƒã®ã‚¯ãƒªãƒ¼ãƒŸãƒ¼ã‚¹ãƒ¼ãƒ—</strong></p>
			<ul style="text-align:left; margin:0 auto; display:inline-block;">
				<li>ã‹ã¼ã¡ã‚ƒ â€¦ 200g</li>
				<li>ç‰›ä¹³ â€¦ 150ml</li>
				<li>ãƒã‚¿ãƒ¼ â€¦ å¤§ã•ã˜1</li>
				<li>å¡© â€¦ å°‘ã€…</li>
			</ul>
			<p style="margin-top:10px;">ğŸ«• ã‹ã¼ã¡ã‚ƒã‚’æŸ”ã‚‰ã‹ãç…®ã¦ã€ãƒŸã‚­ã‚µãƒ¼ã§ãƒšãƒ¼ã‚¹ãƒˆçŠ¶ã«ã—ã€ç‰›ä¹³ã¨ãƒã‚¿ãƒ¼ã‚’åŠ ãˆã¦æ¸©ã‚ãŸã‚‰å®Œæˆï¼</p>
		</div>
	</div>

	<!-- AIãƒãƒ£ãƒƒãƒˆãƒ¢ãƒ¼ãƒ€ãƒ« -->
	<div id="aiChatModal" class="modal">
		<div class="chat-modal-content">
			<div class="chat-header">
				<h2><i class="fa-solid fa-robot"></i> ãƒ¬ã‚·ãƒ”ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆAI</h2>
				<button class="close-btn" data-modal="aiChatModal">&times;</button>
			</div>
			<div class="chat-messages" id="chatMessages">
				<div class="message ai">
					<div class="message-bubble">
						<p>ä½•ã‹ãŠæ‰‹ä¼ã„ã§ãã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã™ã‹?<br>(â€»è¿”ä¿¡ã«æ™‚é–“ãŒã‹ã‹ã‚‹å ´åˆãŒã”ã–ã„ã¾ã™)</p>
					</div>
				</div>
			</div>
			<div class="typing-indicator" id="typingIndicator">AIãŒè€ƒãˆä¸­...</div>
			<div class="chat-input-container">
				<input type="text" id="chatInput" class="chat-input" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›..." />
				<button id="sendBtn" class="send-btn">é€ä¿¡</button>
			</div>
		</div>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>
	<script>
		// ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼åˆæœŸåŒ–
		document.addEventListener('DOMContentLoaded', function () {
			var calendarEl = document.getElementById('calendar');
			var calendar = new FullCalendar.Calendar(calendarEl, {
				initialView: window.innerWidth < 768 ? 'dayGridWeek' : 'dayGridMonth',
				locale: 'ja',
				height: 'auto',
				headerToolbar: {
					left: 'prev,next today',
					center: 'title',
					right: window.innerWidth < 768 ? 'dayGridWeek' : 'dayGridMonth,dayGridWeek'
				},
				buttonText: {
					today: 'ä»Šæ—¥',
					month: 'æœˆ',
					week: 'é€±'
				},
				events: function (info, successCallback, failureCallback) {
					fetch('/menu/events')
						.then(response => response.json())
						.then(data => {
							console.log('å–å¾—ã—ãŸã‚¤ãƒ™ãƒ³ãƒˆ:', data);
							successCallback(data);
						})
						.catch(error => {
							console.error('ã‚¤ãƒ™ãƒ³ãƒˆã®å–å¾—ã«å¤±æ•—:', error);
							failureCallback(error);
						});
				},
				eventDidMount: function (info) {
					info.el.title = info.event.title + '\nè³å‘³æœŸé™: ' + info.event.startStr;
				},
				windowResize: function(view) {
					if (window.innerWidth < 768) {
						calendar.changeView('dayGridWeek');
					} else {
						calendar.changeView('dayGridMonth');
					}
				}
			});
			calendar.render();
		});

		// ãƒ¢ãƒ¼ãƒ€ãƒ«åˆ¶å¾¡
		document.addEventListener('DOMContentLoaded', () => {
			// ãƒãƒ­ã‚¦ã‚£ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆã‚¯ãƒªãƒƒã‚¯
			document.getElementById('halloweenEvent').addEventListener('click', () => {
				document.getElementById('recipeModal').style.display = 'block';
			});

			// AIãƒãƒ£ãƒƒãƒˆã‚ªãƒ¼ãƒ—ãƒ³
			document.getElementById('openAiChat').addEventListener('click', () => {
				document.getElementById('aiChatModal').style.display = 'block';
			});

			// ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
			document.querySelectorAll('.close-btn').forEach(btn => {
				btn.addEventListener('click', (e) => {
					const modalId = e.target.dataset.modal;
					document.getElementById(modalId).style.display = 'none';
				});
			});

			// èƒŒæ™¯ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
			window.addEventListener('click', (e) => {
				if (e.target.classList.contains('modal')) {
					e.target.style.display = 'none';
				}
			});
		});

		// AIãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½
		const GEMINI_API_KEY = 'AIzaSyDKVQTeSmmFLtdng-PQvervQAAiity26QQ';
		const chatMessages = document.getElementById('chatMessages');
		const chatInput = document.getElementById('chatInput');
		const sendBtn = document.getElementById('sendBtn');
		const typingIndicator = document.getElementById('typingIndicator');
		let conversationHistory = [];

		async function sendMessage() {
			const message = chatInput.value.trim();
			if (!message) return;

			if (GEMINI_API_KEY === 'YOUR_GEMINI_API_KEY_HERE') {
				addMessage('âš ï¸ APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚HTMLãƒ•ã‚¡ã‚¤ãƒ«ã® GEMINI_API_KEY ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚', 'ai');
				return;
			}

			addMessage(message, 'user');
			chatInput.value = '';
			sendBtn.disabled = true;
			typingIndicator.style.display = 'block';

			conversationHistory.push({
				role: "user",
				parts: [{text: message}]
			});

			try {
				const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${GEMINI_API_KEY}`;

				const response = await fetch(apiUrl, {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json',
					},
					body: JSON.stringify({
						contents: conversationHistory,
						systemInstruction: {
							parts: [{
								text: "ã‚ãªãŸã¯è¦ªåˆ‡ãªæ–™ç†ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚ãƒ¬ã‚·ãƒ”ã‚„æ–™ç†ã«é–¢ã™ã‚‹è³ªå•ã«æ—¥æœ¬èªã§è©³ã—ãç­”ãˆã¦ãã ã•ã„ã€‚ãƒ¬ã‚·ãƒ”ã‚’æ•™ãˆã‚‹éš›ã¯ã€ææ–™ã¨æ‰‹é †ã‚’åˆ†ã‹ã‚Šã‚„ã™ãèª¬æ˜ã—ã¦ãã ã•ã„ã€‚"
							}]
						},
						generationConfig: {
							temperature: 0.7,
							maxOutputTokens: 2048,
							topP: 0.95,
							topK: 40
						}
					})
				});

				if (!response.ok) {
					const errorData = await response.json();
					console.error('API Error Response:', errorData);
					throw new Error(`API Error: ${response.status} - ${errorData.error?.message || 'Unknown error'}`);
				}

				const data = await response.json();
				console.log('API Response:', data);

				if (data.candidates && data.candidates[0]?.content?.parts?.[0]?.text) {
					const aiResponse = data.candidates[0].content.parts[0].text;
					addMessage(aiResponse, 'ai');
				} else {
					throw new Error('äºˆæœŸã—ãªã„ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼ã§ã™');
				}
			} catch (error) {
				console.error('Full Error:', error);
				let errorMsg = 'ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ã€‚ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚';

				if (error.message.includes('API Error: 400')) {
					errorMsg = 'âš ï¸ APIã‚­ãƒ¼ãŒç„¡åŠ¹ã§ã™ã€‚æ­£ã—ã„APIã‚­ãƒ¼ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚';
				} else if (error.message.includes('API Error: 429')) {
					errorMsg = 'âš ï¸ APIã®åˆ©ç”¨åˆ¶é™ã«é”ã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãå¾…ã£ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚';
				}

				addMessage(errorMsg + '\n\nè©³ç´°: ' + error.message, 'ai');
			} finally {
				typingIndicator.style.display = 'none';
				sendBtn.disabled = false;
			}
		}

		function addMessage(text, sender) {
			const messageDiv = document.createElement('div');
			messageDiv.className = `message ${sender}`;
			messageDiv.innerHTML = `<div class="message-bubble">${text}</div>`;
			chatMessages.appendChild(messageDiv);
			chatMessages.scrollTop = chatMessages.scrollHeight;
		}

		sendBtn.addEventListener('click', sendMessage);
		chatInput.addEventListener('keypress', (e) => {
			if (e.key === 'Enter') sendMessage();
		});
	</script>
</body>

</html>403')) {
					errorMsg = 'âš ï¸ APIã‚­ãƒ¼ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚Google Cloud Consoleã§APIã‚’æœ‰åŠ¹åŒ–ã—ã¦ãã ã•ã„ã€‚';
				} else if (error.message.includes('API Error:
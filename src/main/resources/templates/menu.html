<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>ğŸ  ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»é¢</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
	<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.css" rel="stylesheet">
	<style>
		:root {
			/* ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®è‰²å®šç¾© */
			--gradient-top: #cce7ff;
			--gradient-middle: #f9fcff;
			--gradient-bottom: #ffffff;
		}

		body {
			font-family: 'Arial', sans-serif;
			min-height: 100vh;
			margin: 0;
			padding: 20px;
			text-align: center;
			/* ç¸¦ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ */
			background: linear-gradient(to bottom, var(--gradient-top) 0%, var(--gradient-middle) 50%, var(--gradient-bottom) 100%);
		}

		.room {
			width: 1100px;
			margin: 0 auto;
			background-color: #FFFFFF;
			padding: 30px;
			border: 1px solid #C8C8C8;
			border-radius: 8px;
			box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
		}

		.header-controls {
			display: flex;
			justify-content: space-between;
			align-items: flex-start;
		}

		.logout-button {
			background-color: #E0E0E0;
			color: #4A4A4A;
			border: none;
			padding: 8px 15px;
			cursor: pointer;
			border-radius: 5px;
			transition: background-color 0.2s;
			font-size: 0.9em;
		}

		.logout-button:hover {
			background-color: #CCCCCC;
		}

		h1 {
			font-family: "Noto Serif JP";
			font-weight: bold;
			color: royalblue;
			font-size: 2.5em;
			margin-top: 10px;
			margin-bottom: 50px;
			text-align: center;
		}

		.main-table {
			width: 100%;
			text-align: left;
		}

		.main-table td {
			vertical-align: top;
			padding: 10px;
		}

		.refrigerator-button {
			cursor: pointer;
			background: linear-gradient(145deg, #F5F5F5, #E0E0E0);
			border: 1px solid #C8C8C8;
			padding: 0;
			width: 100%;
			height: 350px;
			border-radius: 15px;
			box-shadow: 4px 4px 15px rgba(0, 0, 0, 0.15);
			transition: transform 0.2s, box-shadow 0.2s;
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
		}

		.refrigerator-button:hover {
			transform: translateY(-5px);
			box-shadow: 6px 6px 20px rgba(0, 0, 0, 0.2);
		}

		.refrigerator-icon {
			font-size: 150px;
			color: #28A745;
			margin-bottom: 20px;
		}

		.refrigerator-label {
			font-weight: bold;
			font-size: 1.5em;
			color: #333;
		}

		.controller-panel {
			background-color: #343A40;
			color: #fff;
			padding: 20px;
			border-radius: 10px;
			display: inline-block;
			width: 90%;
			min-width: 250px;
		}

		.controller-panel h2 {
			font-size: 1.2em;
			margin-bottom: 15px;
			border-bottom: 1px solid #495057;
			padding-bottom: 8px;
		}

		.panel-item {
			width: 100%;
			height: 80px;
			border: none;
			padding: 10px;
			cursor: pointer;
			border-radius: 8px;
			transition: background-color 0.2s;
			margin-top: 10px;
			font-size: 1em;
		}

		.panel-item .label {
			display: block;
			font-size: 0.8em;
			margin-top: 5px;
			font-weight: bold;
		}

		.panel-icon {
			font-size: 24px;
		}

		.waste-rate-button {
			background-color: #FFC107;
			color: #333;
		}

		.waste-rate-button:hover {
			background-color: #E0A800;
		}

		.shopping-list-button {
			background-color: #17A2B8;
			color: #fff;
		}

		.shopping-list-button:hover {
			background-color: #138496;
		}

		.user-manage-button {
			background-color: #6C757D;
			color: #fff;
		}

		.user-manage-button:hover {
			background-color: #5A6268;
		}

		.ai-chat-button {
			background-color: #9C27B0;
			color: #fff;
		}

		.ai-chat-button:hover {
			background-color: #7B1FA2;
		}

		.event-section {
			margin-top: 40px;
			background: linear-gradient(135deg, #ffe4a1, #ffb347);
			padding: 20px;
			border-radius: 12px;
			color: #4a3b00;
			box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
			cursor: pointer;
		}

		.calendar-section {
			margin-top: 40px;
			background: #fff;
			padding: 20px;
			border-radius: 12px;
			box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
		}

		.calendar-section h3 {
			margin-bottom: 20px;
			color: #333;
		}

		#calendar {
			max-width: 100%;
			margin: 0 auto;
		}

		.news-section {
			margin-top: 40px;
			text-align: left;
		}

		.news-title {
			font-size: 1.2em;
			font-weight: bold;
			color: #333;
			margin-bottom: 15px;
		}

		.news-card {
			background: #fff;
			border-left: 5px solid #007BFF;
			padding: 10px 15px;
			border-radius: 8px;
			box-shadow: 1px 2px 6px rgba(0, 0, 0, 0.1);
			margin-bottom: 10px;
		}

		.news-card strong {
			color: #007BFF;
		}

		.modal {
			display: none;
			position: fixed;
			z-index: 1000;
			padding-top: 50px;
			left: 0;
			top: 0;
			width: 100%;
			height: 100%;
			background-color: rgba(0, 0, 0, 0.5);
		}

		.modal-content {
			background-color: #fff9f0;
			margin: auto;
			padding: 20px;
			border: 2px solid #ffb347;
			width: 80%;
			max-width: 400px;
			border-radius: 12px;
			text-align: center;
			box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
			animation: fadeIn 0.3s ease-in-out;
		}

		.chat-modal-content {
			background-color: #ffffff;
			margin: auto;
			padding: 0;
			border: none;
			width: 90%;
			max-width: 600px;
			height: 80vh;
			border-radius: 15px;
			box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
			display: flex;
			flex-direction: column;
			animation: fadeIn 0.3s ease-in-out;
		}

		.chat-header {
			background: linear-gradient(135deg, #9C27B0, #7B1FA2);
			color: white;
			padding: 20px;
			border-radius: 15px 15px 0 0;
			display: flex;
			justify-content: space-between;
			align-items: center;
		}

		.chat-header h2 {
			margin: 0;
			font-size: 1.5em;
		}

		.close-btn {
			color: white;
			font-size: 28px;
			font-weight: bold;
			cursor: pointer;
			background: none;
			border: none;
		}

		.close-btn:hover {
			color: #ffccff;
		}

		.chat-messages {
			flex: 1;
			overflow-y: auto;
			padding: 20px;
			background-color: #f5f5f5;
		}

		.message {
			margin-bottom: 15px;
			display: flex;
			width: 100%;
		}

		.message.ai {
			justify-content: flex-start;
		}

		.message.user {
			justify-content: flex-end;
		}

		.message-bubble {
			max-width: 70%;
			padding: 12px 16px;
			border-radius: 18px;
			word-wrap: break-word;
			white-space: pre-wrap;
		}


		.message.ai .message-bubble {
			background-color: #f0f0f0;
			color: #333;
			border: 1px solid #ddd;
			border-bottom-left-radius: 4px;
			text-align: left;
		}


		.message.user .message-bubble {
			background-color: #9C27B0;
			color: white;
			border-bottom-right-radius: 4px;
			text-align: left;

		}


		.chat-input-container {
			padding: 15px;
			background-color: white;
			border-top: 1px solid #ddd;
			border-radius: 0 0 15px 15px;
			display: flex;
			gap: 10px;
		}

		.chat-input {
			flex: 1;
			padding: 12px;
			border: 1px solid #ddd;
			border-radius: 25px;
			font-size: 14px;
			outline: none;
		}

		.chat-input:focus {
			border-color: #9C27B0;
		}

		.send-btn {
			background-color: #9C27B0;
			color: white;
			border: none;
			padding: 12px 24px;
			border-radius: 25px;
			cursor: pointer;
			font-weight: bold;
			transition: background-color 0.2s;
		}

		.send-btn:hover {
			background-color: #7B1FA2;
		}

		.send-btn:disabled {
			background-color: #ccc;
			cursor: not-allowed;
		}

		.typing-indicator {
			display: none;
			padding: 10px;
			color: #666;
			font-style: italic;
		}

		@keyframes fadeIn {
			from {
				opacity: 0;
				transform: translateY(-20px);
			}

			to {
				opacity: 1;
				transform: translateY(0);
			}
		}

		@keyframes slideIn {
			from {
				opacity: 0;
				transform: translateX(-10px);
			}

			to {
				opacity: 1;
				transform: translateX(0);
			}
		}
	</style>
</head>

<body>
	<div class="room">
		<div class="header-controls">
			<div style="flex-grow: 1;"></div>
			<form method="post" action="/logout">
				<button type="submit" class="logout-button" title="ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ">
					<i class="fa-solid fa-right-from-bracket"></i> ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
				</button>
			</form>
		</div>

		<h1 style="
          font-family: 'Cinzel', serif;
          font-size: 42px;
          color: #1a1a1a;
          letter-spacing: 3px;
          text-transform: uppercase;
          border-bottom: 2px solid #c5a572;
          display: inline-block;
          padding-bottom: 6px;
          ">
			Rei Concierge
		</h1>

		<table class="main-table">
			<tr>
				<td style="width: 65%; text-align: center;">
					<form method="get" action="/selectFood">
						<button type="submit" class="refrigerator-button" title="é£Ÿæã®é¸æŠãƒ»ç™»éŒ²">
							<div class="visual">
								<i class="fa-solid fa-house refrigerator-icon"></i>
							</div>
							<span class="refrigerator-label">å†·è”µåº«</span>
						</button>
					</form>
				</td>
				<td style="width: 35%; text-align: center;">
					<div class="controller-panel">
						<h2>Management Panel</h2>
						<table border="0" style="width: 100%; text-align: center;">
							<tr>
								<td style="padding: 5px;">
									<form method="get" action="/waste-rate">
										<button type="submit" class="panel-item waste-rate-button" title="é£Ÿå“ãƒ­ã‚¹ç‡ã®ç¢ºèª">
											<i class="fa-solid fa-chart-pie panel-icon"></i>
											<span class="label">ãƒ­ã‚¹ç‡</span>
										</button>
									</form>
								</td>
								<td style="padding: 5px;">
									<form method="post" action="/shoppingList">
										<button type="submit" class="panel-item shopping-list-button" title="è²·ã„ç‰©ãƒªã‚¹ãƒˆã®ç®¡ç†">
											<i class="fa-solid fa-bag-shopping panel-icon"></i>
											<span class="label">ãƒªã‚¹ãƒˆ</span>
										</button>
									</form>
								</td>
							</tr>
							<tr>
								<td style="padding: 5px;">
									<button type="button" class="panel-item ai-chat-button" id="openAiChat"
										title="AIãƒ¬ã‚·ãƒ”æ¤œç´¢">
										<i class="fa-solid fa-robot panel-icon"></i>
										<span class="label">ãƒ¬ã‚·ãƒ”AI</span>
									</button>
								</td>
								<td style="padding: 5px;">
									<form method="post" action="/menuManageUser">
										<button type="submit" class="panel-item user-manage-button" title="ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šãƒ»ç®¡ç†">
											<i class="fa-solid fa-user-gear panel-icon"></i>
											<span class="label">è¨­å®š</span>
										</button>
									</form>
								</td>
							</tr>
						</table>
					</div>
				</td>
			</tr>
		</table>


		<div class="event-section" id="halloweenEvent">
			<h3>ğŸƒ ãƒãƒ­ã‚¦ã‚£ãƒ³é™å®šãƒ¬ã‚·ãƒ”å…¬é–‹ä¸­!</h3>
			<p>ã‹ã¼ã¡ã‚ƒã‚’ä½¿ã£ãŸã‚¹ã‚¤ãƒ¼ãƒ„ã‚„ã‚¹ãƒ¼ãƒ—ã‚’æ¥½ã—ã‚‚ã†!</p>
		</div>

		<div class="calendar-section">
			<h3>ğŸ“… è³å‘³æœŸé™ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</h3>
			<div id="calendar"></div>
		</div>

		<div class="news-section">
			<div class="news-title">ãŠçŸ¥ã‚‰ã›</div>
			<div class="news-card"><strong>2025/10/22</strong>ã€€ãƒ¬ã‚·ãƒ”ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆAIãŒä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸï¼</div>
			<div class="news-card"><strong>2025/10/22</strong>ã€€ğŸƒãƒãƒ­ã‚¦ã‚£ãƒ³é™å®šãƒ¬ã‚·ãƒ”ã‚’å…¬é–‹ã—ã¾ã—ãŸ!</div>
			<div class="news-card"><strong>2025/10/21</strong>ã€€ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®ãŠçŸ¥ã‚‰ã›ï¼ˆ10/22 0:00ã€œ4:00ï¼‰</div>
			<div class="news-card"><strong>2025/10/20</strong>ã€€æ–°ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’ãƒªãƒªãƒ¼ã‚¹ã—ã¾ã—ãŸ!</div>
		</div>
	</div>

	<!-- ãƒãƒ­ã‚¦ã‚£ãƒ³ãƒ¬ã‚·ãƒ”ãƒ¢ãƒ¼ãƒ€ãƒ« -->
	<div id="recipeModal" class="modal">
		<div class="modal-content">
			<span class="close-btn" data-modal="recipeModal">&times;</span>
			<h2>ğŸƒ ãƒãƒ­ã‚¦ã‚£ãƒ³é™å®šãƒ¬ã‚·ãƒ”</h2>
			<p><strong>ã‹ã¼ã¡ã‚ƒã®ã‚¯ãƒªãƒ¼ãƒŸãƒ¼ã‚¹ãƒ¼ãƒ—</strong></p>
			<ul style="text-align:left; margin:0 auto; display:inline-block;">
				<li>ã‹ã¼ã¡ã‚ƒ â€¦ 200g</li>
				<li>ç‰›ä¹³ â€¦ 150ml</li>
				<li>ãƒã‚¿ãƒ¼ â€¦ å¤§ã•ã˜1</li>
				<li>å¡© â€¦ å°‘ã€…</li>
			</ul>
			<p style="margin-top:10px;">ğŸ«• ã‹ã¼ã¡ã‚ƒã‚’æŸ”ã‚‰ã‹ãç…®ã¦ã€ãƒŸã‚­ã‚µãƒ¼ã§ãƒšãƒ¼ã‚¹ãƒˆçŠ¶ã«ã—ã€ç‰›ä¹³ã¨ãƒã‚¿ãƒ¼ã‚’åŠ ãˆã¦æ¸©ã‚ãŸã‚‰å®Œæˆï¼</p>
		</div>
	</div>

	<!-- AIãƒãƒ£ãƒƒãƒˆãƒ¢ãƒ¼ãƒ€ãƒ« -->
	<div id="aiChatModal" class="modal">
		<div class="chat-modal-content">
			<div class="chat-header">
				<h2><i class="fa-solid fa-robot"></i> ãƒ¬ã‚·ãƒ”ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆAI</h2>
				<button class="close-btn" data-modal="aiChatModal">&times;</button>
			</div>
			<div class="chat-messages" id="chatMessages">
				<div class="message ai">
					<div class="message-bubble">
						<p>ä½•ã‹ãŠæ‰‹ä¼ã„ã§ãã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ<br>(â€»è¿”ä¿¡ã«æ™‚é–“ãŒã‹ã‹ã‚‹å ´åˆãŒã”ã–ã„ã¾ã™)</p>
					</div>
				</div>
			</div>
			<div class="typing-indicator" id="typingIndicator">AIãŒè€ƒãˆä¸­...</div>
			<div class="chat-input-container">
				<input type="text" id="chatInput" class="chat-input" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›..." />
				<button id="sendBtn" class="send-btn">é€ä¿¡</button>
			</div>
		</div>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>
	<script>
		// ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼åˆæœŸåŒ–
		document.addEventListener('DOMContentLoaded', function () {
			var calendarEl = document.getElementById('calendar');
			var calendar = new FullCalendar.Calendar(calendarEl, {
				initialView: 'dayGridMonth',
				locale: 'ja',
				height: 'auto',
				headerToolbar: {
					left: 'prev,next today',
					center: 'title',
					right: 'dayGridMonth,dayGridWeek'
				},
				buttonText: {
					today: 'ä»Šæ—¥',
					month: 'æœˆ',
					week: 'é€±'
					
				},
				events: function (info, successCallback, failureCallback) {
					fetch('/menu/events')
						.then(response => response.json())
						.then(data => {
							console.log('å–å¾—ã—ãŸã‚¤ãƒ™ãƒ³ãƒˆ:', data);
							successCallback(data);
						})
						.catch(error => {
							console.error('ã‚¤ãƒ™ãƒ³ãƒˆã®å–å¾—ã«å¤±æ•—:', error);
							failureCallback(error);
						});
				},
				eventDidMount: function (info) {
					info.el.title = info.event.title + '\nè³å‘³æœŸé™: ' + info.event.startStr;
				}
			});
			calendar.render();
		});

		// ãƒ¢ãƒ¼ãƒ€ãƒ«åˆ¶å¾¡
		document.addEventListener('DOMContentLoaded', () => {
			// ãƒãƒ­ã‚¦ã‚£ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆã‚¯ãƒªãƒƒã‚¯
			document.getElementById('halloweenEvent').addEventListener('click', () => {
				document.getElementById('recipeModal').style.display = 'block';
			});

			// AIãƒãƒ£ãƒƒãƒˆã‚ªãƒ¼ãƒ—ãƒ³
			document.getElementById('openAiChat').addEventListener('click', () => {
				document.getElementById('aiChatModal').style.display = 'block';
			});

			// ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
			document.querySelectorAll('.close-btn').forEach(btn => {
				btn.addEventListener('click', (e) => {
					const modalId = e.target.dataset.modal;
					document.getElementById(modalId).style.display = 'none';
				});
			});

			// èƒŒæ™¯ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
			window.addEventListener('click', (e) => {
				if (e.target.classList.contains('modal')) {
					e.target.style.display = 'none';
				}
			});
		});

		// AIãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½
		const GEMINI_API_KEY = 'AIzaSyDKVQTeSmmFLtdng-PQvervQAAiity26QQ';
		const chatMessages = document.getElementById('chatMessages');
		const chatInput = document.getElementById('chatInput');
		const sendBtn = document.getElementById('sendBtn');
		const typingIndicator = document.getElementById('typingIndicator');
		let conversationHistory = [];
		async function sendMessage() {
			const message = chatInput.value.trim();
			if (!message) return;

			// APIã‚­ãƒ¼ã®ãƒã‚§ãƒƒã‚¯
			if (GEMINI_API_KEY === 'YOUR_GEMINI_API_KEY_HERE') {
				addMessage('âš ï¸ APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚HTMLãƒ•ã‚¡ã‚¤ãƒ«ã® GEMINI_API_KEY ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚', 'ai');
				return;
			}

			// ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
			addMessage(message, 'user');
			chatInput.value = '';
			sendBtn.disabled = true;
			typingIndicator.style.display = 'block';

			// ä¼šè©±å±¥æ­´ã«è¿½åŠ 
			conversationHistory.push({
				role: "user",
				parts: [{text: message}]
			});

			try {
				const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${GEMINI_API_KEY}`;

				const response = await fetch(apiUrl, {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json',
					},
					body: JSON.stringify({
						contents: conversationHistory,
						systemInstruction: {
							parts: [{
								text: "ã‚ãªãŸã¯è¦ªåˆ‡ãªæ–™ç†ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚ãƒ¬ã‚·ãƒ”ã‚„æ–™ç†ã«é–¢ã™ã‚‹è³ªå•ã«æ—¥æœ¬èªã§è©³ã—ãç­”ãˆã¦ãã ã•ã„ã€‚ãƒ¬ã‚·ãƒ”ã‚’æ•™ãˆã‚‹éš›ã¯ã€ææ–™ã¨æ‰‹é †ã‚’åˆ†ã‹ã‚Šã‚„ã™ãèª¬æ˜ã—ã¦ãã ã•ã„ã€‚"
							}]
						},
						generationConfig: {
							temperature: 0.7,
							maxOutputTokens: 2048,
							topP: 0.95,
							topK: 40
						}
					})
				});

				if (!response.ok) {
					const errorData = await response.json();
					console.error('API Error Response:', errorData);
					throw new Error(`API Error: ${response.status} - ${errorData.error?.message || 'Unknown error'}`);
				}

				const data = await response.json();
				console.log('API Response:', data);

				if (data.candidates && data.candidates[0]?.content?.parts?.[0]?.text) {
					const aiResponse = data.candidates[0].content.parts[0].text;
					addMessage(aiResponse, 'ai');
				} else {
					throw new Error('äºˆæœŸã—ãªã„ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼ã§ã™');
				}
			} catch (error) {
				console.error('Full Error:', error);
				let errorMsg = 'ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ã€‚ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚';

				if (error.message.includes('API Error: 400')) {
					errorMsg = 'âš ï¸ APIã‚­ãƒ¼ãŒç„¡åŠ¹ã§ã™ã€‚æ­£ã—ã„APIã‚­ãƒ¼ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚';
				} else if (error.message.includes('API Error: 403')) {
					errorMsg = 'âš ï¸ APIã‚­ãƒ¼ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚Google Cloud Consoleã§APIã‚’æœ‰åŠ¹åŒ–ã—ã¦ãã ã•ã„ã€‚';
				} else if (error.message.includes('API Error: 429')) {
					errorMsg = 'âš ï¸ APIã®åˆ©ç”¨åˆ¶é™ã«é”ã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãå¾…ã£ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚';
				}

				addMessage(errorMsg + '\n\nè©³ç´°: ' + error.message, 'ai');
			} finally {
				typingIndicator.style.display = 'none';
				sendBtn.disabled = false;
			}
		}

		function addMessage(text, sender) {
			const messageDiv = document.createElement('div');
			messageDiv.className = `message ${sender}`;
			messageDiv.innerHTML = `<div class="message-bubble">${text}</div>`;
			chatMessages.appendChild(messageDiv);
			chatMessages.scrollTop = chatMessages.scrollHeight;
		}

		sendBtn.addEventListener('click', sendMessage);
		chatInput.addEventListener('keypress', (e) => {
			if (e.key === 'Enter') sendMessage();
		});
	</script>
</body>

</html>